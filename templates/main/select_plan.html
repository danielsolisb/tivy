{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Elige tu Plan - Tivy{% endblock %}

{% block content %}
<div class="bg-subtle-bg dark:bg-dark-subtle-bg min-h-[calc(100vh-4rem)] py-16">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <div class="text-center mb-16">
            <h1 class="text-4xl font-black tracking-tight text-primary dark:text-white sm:text-5xl">
                Selecciona el plan ideal
            </h1>
            <p class="mt-4 text-xl text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
                Elige cómo quieres empezar. Puedes cambiar o cancelar tu plan en cualquier momento.
            </p>
        </div>
        
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 items-start justify-center">
            {% for plan in plans %}
                <div class="p-8 bg-background-light dark:bg-background-dark rounded-xl h-full flex flex-col relative overflow-hidden transition-transform hover:-translate-y-1 duration-300
                            {% if plan.name == 'Profesional' %}
                                shadow-xl border-2 border-secondary z-10
                            {% else %}
                                shadow-md border border-gray-200 dark:border-gray-700
                            {% endif %}">
                    
                    {% if plan.name == 'Profesional' %}
                        <div class="absolute top-0 right-0 text-xs font-bold bg-secondary text-primary px-4 py-1 rounded-bl-lg">
                            Recomendado
                        </div>
                    {% endif %}

                    <h3 class="text-xl font-bold text-primary dark:text-white">{{ plan.name }}</h3>
                    
                    <p class="mt-6 text-4xl font-bold text-primary dark:text-white">
                        ${{ plan.price_monthly|floatformat:0 }} <span class="text-lg font-medium text-gray-500">/ mes</span>
                    </p>
                    
                    <ul class="mt-8 space-y-4 text-gray-600 dark:text-gray-300 flex-grow">
                        <li class="flex items-center gap-3">
                            <span class="material-symbols-outlined text-secondary">check</span> 
                            {% if plan.max_staff == -1 %}<strong>Personal Ilimitado</strong>
                            {% elif plan.max_staff == 1 %}1 Miembro de Personal
                            {% else %}{{ plan.max_staff }} Miembros de Personal{% endif %}
                        </li>
                        <li class="flex items-center gap-3"><span class="material-symbols-outlined text-secondary">check</span> Citas Ilimitadas</li>
                        <li class="flex items-center gap-3"><span class="material-symbols-outlined text-secondary">check</span> Reservas Online</li>
                        
                        {% if plan.allow_payments %}
                            <li class="flex items-center gap-3"><span class="material-symbols-outlined text-secondary">check</span> <strong>Pagos Online</strong></li>
                        {% endif %}
                    </ul>

                    <a href="{% url 'register' %}?plan={{ plan.id }}" 
                       class="w-full mt-8 flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-5 font-bold transition-colors duration-200
                              {% if plan.name == 'Profesional' %}
                                bg-secondary text-primary hover:opacity-90 shadow-lg shadow-secondary/20
                              {% else %}
                                bg-primary/10 text-primary dark:text-secondary dark:bg-secondary/20 dark:hover:bg-secondary/30 hover:bg-primary/20
                              {% endif %}">
                       Comenzar con {{ plan.name }}
                    </a>
                </div>
            {% empty %}
                <div class="col-span-3 text-center py-12">
                    <p class="text-gray-500 text-lg">No hay planes configurados en el sistema aún.</p>
                </div>
            {% endfor %}
        </div>

        <div class="text-center mt-12">
            <p class="text-sm text-gray-500">¿Ya tienes una cuenta? <a href="{% url 'login' %}" class="font-semibold text-primary hover:text-secondary">Inicia sesión</a></p>
        </div>
    </div>
</div>
{% endblock %}